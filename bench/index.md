# Benchmark

Below are benchmarks of body-parser vs milliparsec and formidable vs
milliparsec. Please take into account that these benchmarks are not entirely
accurate, since they are taken on a regular desktop computer in usual
conditions.

## Environment

- Node.js 22.3.1
- System: macOS Sequoia 15.3.1 / Darwin 24.3.0 arm64 kernel
- CPU: Apple M2 (8) @ 3.50 GHz
- Machine: MacBook Air (M2, 2022)

## JSON parsing

### Benchmark command:

```sh
autocannon -m POST -b '{"a":1}' -H "Content-Type=application/json" localhost:3002 # or 3003
```

### Results

body-parser result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.12 ms │ 22 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼──────────┼─────────┤
│ Req/Sec   │ 54,591  │ 54,591  │ 61,759  │ 63,871  │ 61,436.8 │ 2,478.39 │ 54,589  │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼──────────┼─────────┤
│ Bytes/Sec │ 7.05 MB │ 7.05 MB │ 7.97 MB │ 8.24 MB │ 7.93 MB  │ 319 kB   │ 7.04 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 10

614k requests in 10.01s, 79.3 MB read
```

milliparsec result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.04 ms │ 11 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 79,999  │ 79,999  │ 88,127  │ 88,767  │ 87,095.28 │ 2,370.01 │ 79,966  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 9.76 MB │ 9.76 MB │ 10.7 MB │ 10.8 MB │ 10.6 MB   │ 289 kB   │ 9.76 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 11

958k requests in 11.01s, 117 MB read

Req/Bytes counts sampled once per second.
# of samples: 11

641k requests in 11.02s, 78.2 MB read
```

### Verdict

milliparsec, on average, is ~40% faster.

## Multipart with files

### Benchmark command:

```sh
autocannon -m POST --form '{ "file": {  "type": "file", "path": "./file.txt"  } }' localhost:3004
```

### Results

formidable result:

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 1 ms │ 5 ms │ 19 ms │ 26 ms │ 6.63 ms │ 5.86 ms │ 54 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬────────┬────────┬────────┬──────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%  │ Avg    │ Stdev    │ Min    │
├───────────┼────────┼────────┼────────┼────────┼────────┼──────────┼────────┤
│ Req/Sec   │ 530    │ 530    │ 775    │ 4,595  │ 1,404  │ 1,179.32 │ 530    │
├───────────┼────────┼────────┼────────┼────────┼────────┼──────────┼────────┤
│ Bytes/Sec │ 105 kB │ 105 kB │ 153 kB │ 910 kB │ 278 kB │ 233 kB   │ 105 kB │
└───────────┴────────┴────────┴────────┴────────┴────────┴──────────┴────────┘

Req/Bytes counts sampled once per second.
# of samples: 10

14k requests in 10.02s, 2.78 MB read
```

milliparsec result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.02 ms │ 0.19 ms │ 20 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 24,063  │ 24,063  │ 29,727  │ 30,863  │ 29,263.28 │ 1,758.94 │ 24,051  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 4.76 MB │ 4.76 MB │ 5.89 MB │ 6.11 MB │ 5.79 MB   │ 348 kB   │ 4.76 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 11

322k requests in 11.01s, 63.7 MB read
```

### Verdict

milliparsec, on average, is ~20x faster.
