# Benchmark

Below are benchmarks of body-parser vs milliparsec and formidable vs
milliparsec. Please take into account that these benchmarks are not entirely
accurate, since they are taken on a regular desktop computer in usual
conditions.

## Environment

- Node.js 22.3.0
- System: macOS Sequoia 15.3.1 / Darwin 24.3.0 arm64 kernel
- CPU: Apple M2 (8) @ 3.50 GHz
- Machine: MacBook Air (M2, 2022)

## JSON parsing

### Benchmark command:

```sh
autocannon -b '{"a":1}' -H "Content-Type=application/json" localhost:3002 # or 3003
```

### Results

body-parser result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼────────┤
│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.91 ms │ 272 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 30,767  │ 30,767  │ 41,343  │ 44,191 │ 39,307.64 │ 4,333.33 │ 30,762  │
├───────────┼─────────┼─────────┼─────────┼────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 3.97 MB │ 3.97 MB │ 5.33 MB │ 5.7 MB │ 5.07 MB   │ 560 kB   │ 3.97 MB │
└───────────┴─────────┴─────────┴─────────┴────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 11

432k requests in 11.03s, 55.8 MB read
```

milliparsec result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼────────┤
│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.68 ms │ 255 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼──────────┼─────────┤
│ Req/Sec   │ 46,047  │ 46,047  │ 59,391  │ 64,255  │ 58,285.1 │ 4,625.15 │ 46,025  │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼──────────┼─────────┤
│ Bytes/Sec │ 5.62 MB │ 5.62 MB │ 7.25 MB │ 7.84 MB │ 7.11 MB  │ 565 kB   │ 5.62 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 11

641k requests in 11.02s, 78.2 MB read
```

### Verdict

milliparsec, on average, is ~30-40% faster.

## Multipart with files

### Benchmark command:

```sh
autocannon -m POST --form '{ "file": {  "type": "file", "path": "./file.txt"  } }' localhost:3004
```

### Results

formidable result:

```
┌─────────┬──────┬───────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%   │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼───────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 1 ms │ 10 ms │ 29 ms │ 33 ms │ 11.1 ms │ 9.48 ms │ 261 ms │
└─────────┴──────┴───────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬───────┬───────┬────────┬────────┬────────┬────────┬───────┐
│ Stat      │ 1%    │ 2.5%  │ 50%    │ 97.5%  │ Avg    │ Stdev  │ Min   │
├───────────┼───────┼───────┼────────┼────────┼────────┼────────┼───────┤
│ Req/Sec   │ 500   │ 500   │ 630    │ 2,339  │ 860.9  │ 526.44 │ 500   │
├───────────┼───────┼───────┼────────┼────────┼────────┼────────┼───────┤
│ Bytes/Sec │ 99 kB │ 99 kB │ 125 kB │ 463 kB │ 170 kB │ 104 kB │ 99 kB │
└───────────┴───────┴───────┴────────┴────────┴────────┴────────┴───────┘

Req/Bytes counts sampled once per second.
# of samples: 10

9k requests in 10.03s, 1.7 MB read
```

milliparsec result:

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼────────┤
│ Latency │ 0 ms │ 0 ms │ 1 ms  │ 1 ms │ 0.09 ms │ 1.39 ms │ 267 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 8,543   │ 8,543   │ 17,775  │ 18,399  │ 16,962.55 │ 2,697.57 │ 8,537   │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 1.69 MB │ 1.69 MB │ 3.52 MB │ 3.64 MB │ 3.36 MB   │ 534 kB   │ 1.69 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 11

187k requests in 11.03s, 36.9 MB read
```

### Verdict

milliparsec, on average, is 10-20x faster.
